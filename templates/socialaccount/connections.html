{% extends 'index.html' %}
{% load static %}
{% load socialaccount %}
{% block title %}Linked Accounts{% endblock %}

{% block nav_icon %}
  <button class="primary"><i class="material-icons">arrow_back</i></button>
{% endblock %}
{% block nav_text %}Linked Accounts{% endblock %}
{% block nav_auth_links %}{% endblock %}

{% block content %}
<div class="w3-row w3-padding">
    <br/>
    <h1>Linked Accounts</h1>
    <br/>
    {% if form.accounts %}
    <h4>You can also sign in to your Knotters account using any of your following linked accounts.</h4>
    <br/>
    <form method="post" action="{% url 'socialaccount_connections' %}">
        {% csrf_token %}
        <fieldset>
        {% if form.non_field_errors %}
        <div id="errorMsg">{{ form.non_field_errors }}</div>
        {% endif %}

        {% for base_account in form.accounts %}
            {% with base_account.get_provider_account as account %}
            <div class="w3-row w3-padding">
                <label for="id_account_{{ base_account.id }}">
                    <input id="id_account_{{ base_account.id }}" type="radio" name="account" value="{{ base_account.id }}"/>
                    <span class="socialaccount_provider {{ base_account.provider }} {{ account.get_brand.id }}">{{account.get_brand.name}}</span>
                {{ account }}
                </label>
            </div>
            {% endwith %}
        {% endfor %}

        <div class="w3-row w3-padding">
            <button class="negative" type="submit">Remove</button>
        </div>
        </fieldset>
    </form>

    {% else %}
    <h5>You currently have no 3rd party accounts linked.</h5>
    {% endif %}
    <br/>
    <h2>Link a 3rd Party Account</h2>
    <div class="w3-row w3-padding">
        {% get_providers as socialaccount_providers %}
        {% for provider in socialaccount_providers %}
            {% if provider.id == "openid" %}
                {% for brand in provider.get_brands %}
                <div class="w3-col w3-half">
                <a title="{{brand.name}}"
                    class="socialaccount_provider {{provider.id}} {{brand.id}}"
                    href="{% provider_login_url provider.id openid=brand.openid_url process='connect' %}"
                    ><button class="primary">{{brand.name}}</button></a>
                </div>
                {% endfor %}
            {% endif %}
            <div class="w3-padding">
            {% for base_account in form.accounts %}
             {% if base_account.provider != provider.id %}
                <a title="{{provider.name}}" class="socialaccount_provider {{provider.id}}" 
                    href="{% provider_login_url provider.id process='connect' scope=scope auth_params=auth_params %}">
                    <button class="{% if provider.name == "GitHub" %}secondary{% else %}primary{% endif %} w3-padding">
                        <img src="/static/graphics/thirdparty/{{provider.name}}{% if provider.name == "GitHub" %}-dark{% endif %}.png" width="25" />
                        Link {{provider.name}} account
                    </button>
                </a>
             {% endif %}
             {% empty %}
             <a title="{{provider.name}}" class="socialaccount_provider {{provider.id}}" 
                    href="{% provider_login_url provider.id process='connect' scope=scope auth_params=auth_params %}">
                    <button class="{% if provider.name == "GitHub" %}secondary{% else %}primary{% endif %} w3-padding">
                        <img src="/static/graphics/thirdparty/{{provider.name}}{% if provider.name == "GitHub" %}-dark{% endif %}.png" width="25" />
                        Link {{provider.name}} account
                    </button>
                </a>
            {% endfor %}
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
