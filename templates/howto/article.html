{% extends 'howto/index.html' %}
{% load static %}
{% load i18n %}
{% load l10n %}
{% load tz %}
{% load cache %}
{% load custom_tags %}

{% block content %}
<div class="w3-row w3-padding tertiary">
    <div class="w3-col w3-container m4 l3 w3-animate-left">
        <div class="w3-row pallete w3-center w3-animate-zoom" style="padding: 0">
            <h5>{{article.heading}}</h5>
            {{article.subheading}}<br />
        </div>
        <br />
        <div class="w3-row w3-padding-small">
            <div id="view-articletags">
                {% for tag in article.tags.all %}
                <a href="{{URLS.HOWTO}}?search=tag:{{tag}}"><button class="small positive">#{{tag}}</button></a>
                {% empty %}
                    <h6 class="dead-text">{% trans "No tags assigned" %}</h6>
                {% endfor %}
                {% if self %}<i class="edit-action w3-right" data-edittarget="articletags">edit</i>{% endif %}
            </div>
            {% if self %}
            <div id="edit-articletags">
                <strong class="dead-text">{% trans "Total 5 tags allowed" %}</strong>
                <form class="no-auto" id="edit-tag-inputs">
                    {% csrf_token %}
                    <input class="wide primary" maxlength="40" placeholder="{% trans "Search tags" %}" id="tag-search-input" />
                    <div class="w3-row w3-padding" id="tags-viewer">
                        {% for tag in article.tags.all %}
                        <button type="button" class="primary small negative-text tag-existing" data-icon="close" id="{{tag.id}}">{{tag.name}}</button>
                        {% endfor %}
                        <div class="w3-row w3-padding" id="tags-viewer-new"></div>
                    </div>
                    <input id="removetagIDs" name="removetagIDs" hidden type="text" />
                    <input id="addtagIDs" name="addtagIDs" hidden type="text" />
                    <input id="addtags" name="addtags" hidden type="text" />
                    <button class="small" id="save-edit-articletags" data-icon="done">{% trans "Save" %}</button>
                    <button class="small" id="discard-edit-articletags" data-icon="close">{% trans "Cancel" %}</button>
                </form>
            </div>
            {% endif %}
        </div>
        <br />
        <div class="w3-row pallete">
            <h5 class="align"><i>description</i>&nbsp;Description</h5><br/>
            <strong>{% trans "Author : " %}</strong><a href="{{article.author.getLink}}"><button class="primary"><img class="circle" src="{{article.author.getDP}}"  width="20"/>&nbsp;{{article.author.getName}}{% if article.author.is_verified %}<i class="positive-text w3-large">verified</i>{% endif %}</button></a><br/><br/>
            <strong>{% trans "Created on : " %} <span>{{article.createdOn}}</span></strong><br/><br/>
            <strong>{% trans "Last Updated on : " %} <span>{{article.modifiedOn}}</span></strong><br/>
        </div>
        {% if self %}
        <br />
        <div class="w3-row pallete">
            <h5 class="align"><i class="w3-spin">settings</i>&nbsp;{% trans "Settings" %}</h5>
            <br />
            <div class="w3-row align">
                <input type="hidden" value="{{ article.id }}" id="articleid">
                <input type="hidden" value="{{ article.is_draft }}" id="draft">
                <button id="deleteArticle" class="negative w3-large w3-animate-zoom" type="submit">Delete Article</button>
                <button id="draftArticle" class="accent w3-large w3-animate-zoom">
                    {% if article.is_draft %}
                    Publish Article
                    {% else %}
                    Draft Article
                    {% endif %}
                </button>
            </div>
        </div>
        {% endif %}
    </div>
    <div class="w3-col w3-container m8 l9 pallete" id="sections">
        <div class="w3-row">
            {% include 'howto/sections.html' %}
        </div>
        <br />
        <div class="w3-row align">
            {% if self %}
                <div class="w3-row" id="view-section">
                    <button class="large edit-action" data-icon='add' id="create-snap" data-edittarget="section">Add Section</button>
                </div>
                <div class="w3-row" id="edit-section">
                    <br />
                    <input type='file' hidden id='snap-file' accept="image/png, image/jpg, image/jpeg" />
                    <form action="{{URLS.SECTION|params:article.id|params:'create'}}" method="POST">
                        {% csrf_token %}
                        <input type="text" name="subheading" placeholder="subheading"><br />
                        <textarea class="wide snapshot-input" name='paragraph' rows="3" placeholder="Paragraph"></textarea>
                        <input class="snapshot-input" type="text" id='snapimage' name='snapimage' hidden />
                        <img width='100%' id='snapimageview' hidden class="snapshot-image preview-type-image" />
                        <div class="dead-text" id='add-image-view'>
                            <label for="snap-file">
                                <div class="w3-jumbo material-icons">add_circle</div>
                                <h5>Add image</h5>
                            </label>
                        </div>
                        <button class="small positive" type='submit' id="save-edit-section" data-icon="done">{% trans "Publish Section" %}</button>
                        <button class="small negative" type='button' id="discard-edit-section" data-icon="close">{% trans "Discard" %}</button>
                    </form>
                </div>
            {% endif %}
        </div>
        <br />
    </div>
    <br />
</div>
{% endblock %}
{% block scripts %}
<script nonce="{{request.csp_nonce}}" src="{{URLS.SCRIPTS_SUBAPP|params:SUBAPPNAME|params:SCRIPTS.ARTICLE}}?self={{self}}"></script>
{% endblock %}
