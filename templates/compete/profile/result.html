{% load custom_tags %}

<div class="w3-row w3-padding">
{% if results.count %}

    {% if selfInvaildSubmission %}
        <center class="negative-text">

        <i title="Private to you">lock</i><br/>
        <strong>
        You submission was marked invalid.</strong>
        </center>
    {% endif %}
<div class="w3-row w3-padding w3-hide-small">
    <div class="w3-col w3-quarter">
        <div class="w3-col w3-half">
        <h5>Rank</h5>
        </div>
        <div class="w3-col w3-half">
        <h5>Score</h5>
        </div>
    </div>
    <div class="w3-col w3-threequarter">
        <div class="w3-col w3-threequarter">
        <h5>Members</h5>
        </div>
        <div class="w3-col w3-quarter w3-center">
        <h5>Submission</h5>
        </div>
    </div>
</div>
{% endif %}

{% if selfresult %}
<div class="w3-row pallete-slab w3-padding-small">
    <div class="w3-col m3">
    <button class="pallete w3-padding-small limit-width">
        <i>card_giftcard</i>{{selfresult.rank}}<sup>{{selfresult.rankSuptext}}</sup>
    </button>
    </div>
    <div class="w3-col m9">
    <div class="w3-col m9 w3-padding-small">
    {% for member in selfresult.submission.getMembers %}
    <a target="_blank" href="{{member.getLink}}">
    <button class="small primary">
        <img src="{{member.getDP}}" class="w3-circle" width="18" />
        <span class="w3-hide-small">{{ member.getFame }}</span>
    </button>
    </a>
    {% endfor %}
    </div>
    <div class="w3-col m3">
    <a 
    {% if request.user.is_authenticated %}
    target="_blank" 
    href="{{ selfresult.submission.repo }}"
    {% else %}
    href="{% url 'account_login' %}?next=/compete/{{competition.id}}"
    {% endif %}
    ><button class="primary" data-icon="open_in_new">View</button></a>
    </div>
    </div>
</div>
{% endif %}

{% for result in results %}
<div class="w3-row pallete-slab w3-padding-small">
    <div class="w3-col m3">
        <div class="w3-col w3-half">
            <button
                class="pallete w3-padding-small limit-width {% if result.rank == 1 %}accent{% elif result.rank == 2 %}active{% elif result.rank == 3 %}positive{% else %}primary{% endif %} 
                text-{% if result.rank == 1 %}accent{% elif result.rank == 2 %}active{% elif result.rank == 3 %}positive{% else %}primary{% endif %}"
            ><i>
                {% if result.rank == 1 %}emoji_events{% elif result.rank == 2 %}military_tech{% elif result.rank == 3 %}celebration{% else %}card_giftcard{% endif %}
            </i>{{result.rank}}<sup>{{result.rankSuptext}}</sup>
            </button>
        </div>
        <div class="w3-col w3-half w3-padding-small">
            <button class="small primary">{{result.points}} <span class="w3-hide-large w3-hide-medium">points</span></button>
        </div>
    </div>
    <div class="w3-col m9">
    <div class="w3-col m9 w3-padding-small">
    
    {% for member in result.submission.getMembers %}
    <a target="_blank" href="{{member.getLink}}">
    <button class="small {% if result.rank == 1 %}accent{% elif result.rank == 2 %}active{% elif result.rank == 3 %}positive{% else %}primary{% endif %}">
        <img src="{{member.getDP}}" class="w3-circle" width="18" />
        <span class="w3-hide-small">{{ member.getFName }}</span>
    </button>
    </a>
    {% endfor %}
    </div>
    <div class="w3-col m3">
    <a 
    {% if request.user.is_authenticated %}
    target="_blank" 
    href="{{ result.submission.repo }}"
    {% else %}
    href="{% url 'account_login' %}?next=/compete/{{competition.id}}"
    {% endif %}
    >
    <button class="w3-right small primary" data-icon="open_in_new">View</button>
    </a>
    {% if request.user.is_authenticated and request.user.profile in result.submission.getMembers %}
    
        {% if request.user.profile not in result.xpclaimers.all %}
        <form method="POST" action="{{URLS.CLAIMXP|params:result.submission.competition.getID|params:result.submission.getID}}">
            {% csrf_token %}
            <button type="submit" class="w3-right small positive" data-icon="grade" title="Earned points will be incremented as XP to your profile.">Claim XP</button>
        </form>
        {% else %}
        <button class="w3-right small secondary" title="You have already claimed {{result.points}} XP of your result">XP Claimed</button>
        {% endif %}
    {% endif %}
    </div>
    </div>
</div>
{% empty %}
    <br/><br/>
    <center>
    <div class="w3-jumbo material-icons">lock</div>
    <h1>No results disclosed.</h1>
    </center>
{% endfor %}
</div>