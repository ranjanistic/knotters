{% extends 'management/community/index.html' %}

{% block nav_href %}{{URLS.COMMUNITY}}{% endblock %}
{% block nav_text %}Labels{% endblock %}
{% block content %}
<div class="w3-row">

<div class="w3-row w3-padding-small w3-center">
    <button id="category" class="nav-tab" >Categories</button>
    <button id="topic" class="nav-tab" >Topics</button>
    <button id="tag" class="nav-tab" >Tags</button>
</div>
<div id="tabview"></div>

</div>

{% endblock %}

{% block scripts %}
<script>
initializeTabsView({
    onEachTab: async (tab) => {
        return await getRequest(setUrlParams(URLS.LABEL_TYPE, tab.id));
    },
    uniqueID: "labeltab",
    onShowTab: (tab) => {
        getElement(`create-${tab.id}`).onclick=_=>{
            alertify.confirm(`Create new ${tab.id}`, `
                <input id="new-${tab.id}-name" class="wide" placeholder="Name of the ${tab.id}" required type="text" />
            `,
            async()=>{
                let name = String(getElement(`new-${tab.id}-name`).value).trim();
                if(!name) return error(`Name is required for a new ${tab.id}.`)
                const data = await postRequest(setUrlParams(URLS.LABEL_CREATE, tab.id), {name})
                if(!data) return
                if(data.code===code.OK){
                    message(`${name} ${tab.id} was created.`)
                    tab.click()
                    return
                }
                error(data.error)
            },
            ()=>{}
            ).set('closable', false).set('labels', {ok:'Create', cancel:'Discard'})
        }
        console.log(tab.id)
        if(tab.id==='tag'){
        console.log(tab.id)
            getElements('delete-tag').forEach((tag)=>{
                tag.onclick=(e)=>{
                    const name = e.target.getAttribute('data-tagname')
                    const tagID = e.target.getAttribute('data-tagID')
                    alertify.confirm(`Delete tag ${name}?`, `
                        <h4>Delete tag '${name}' from ${APPNAME}, are you sure? (This tag will be removed from all linked assets)</h4>
                        `,
                        async ()=>{
                            const data = await postRequest(setUrlParams(URLS.LABEL_DELETE, tab.id, tagID))
                            if(!data) return
                            if(data.code===code.OK){
                                hideElement(`tag-view-${tagID}`)
                                message(`Tag '${name}' was deleted.`)
                                return
                            }
                            error(data.error)
                        },
                        ()=>{}
                    ).set('closable', false).set('labels', {ok:'Delete', cancel:'Cancel'})
                }
            })
        }
    }
});

</script>
{% endblock %}
