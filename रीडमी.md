# Knotters

Knotters प्लेटफॉर्म स्रोत कोड।

देखें [CONTRIBUTING.md](CONTRIBUTING.md) अगर आपने पूरा रीडमी.md पढ़ लिया है और इस फाइल में दिए निर्देश के अनुसार पहले ही रिपॉजिटरी सेटअप कर चुके हैं। यदि नहीं, तो पहले निम्न चरणों का पालन करें, फिर आगे के योगदान दिशानिर्देशों के लिए [CONTRIBUTING.md](CONTRIBUTING.md) पर जाएं।

## स्थापना

लिनक्स वातावरण को प्राथमिकता दी जाती है, इसलिए यदि आप अपने पीसी को लिनक्स के साथ बूट/डुअल बूट करने की योजना बना रहे थे, तो यह सही समय है।

विंडोज़ डेवलपर्स जो लिनक्स को बूट नहीं करना चाहते हैं, [सेटअप WSL](https://docs.microsoft.com/en-us/windows/wsl/install) पहले।

_सभी कमांड/बैश स्क्रिप्ट को प्रोजेक्ट डायरेक्टरी के मूल में निष्पादित माना जाना चाहिए, जब तक कि स्पष्ट रूप से निर्दिष्ट न हो।_

_`python3` (पायथन), `pip` (पायथन पैकेज मैनेजर) - ये cmdlets आपके सिस्टम प्लेटफॉर्म के आधार पर भिन्न हो सकते हैं, इसलिए, तदनुसार कार्य करें।_

### पूर्वापेक्षाएँ

- python 3.8.x या इसके बाद के संस्करण
- pip 20.x या ऊपर
- MongoDB (5.0.x) कनेक्शन स्ट्रिंग (mongodb://user:password@host:port/database)
- एक चलता redis (6.x या ऊपर) सर्वर

पहली बार स्थानीय रूप से mongodb स्थापित करने के लिए, [इन चरणों](https://www.digitalocean.com/community/tutorials/how-to-install-mongodb-on-ubuntu-18-04-source) को देखें

रेडिस को पहली बार स्थानीय रूप से स्थापित करने के लिए, [इन चरणों](https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-ubuntu-18-04) को देखें

WSL उपयोगकर्ताओं के लिए, `systemctl` जैसे कमांड मौजूद नहीं हो सकते हैं, इसलिए तदनुसार आगे बढ़ें। (उदाहरण के लिए `systemctl` के लिए `service` कमांड का उपयोग करें)

रेडिस सेट करने के बाद, अपनी रेडिस कॉन्फ़िगरेशन फ़ाइल (आमतौर पर /etc/redis/redis.conf पर) में acl अनुभाग में एक उपयोगकर्ता और पासवर्ड जोड़ी जोड़ें, जो सभी कुंजियों और सभी आदेशों तक पहुंच बनाएगी।
रेडिस में `requirepass` का अब उपयोग नहीं किया जा रहा है।

इसके कॉन्फ़िगरेशन में किसी भी बदलाव के बाद रेडिस को पुनरारंभ करें।

### पर्यावरण

```bash
python3 setup.py
```

[`main/.env`](main/.env) और [`main/.env.testing`](main/.env.testing) में मानों की मैन्युअल रूप से जाँच करें और साथ ही सब कुछ ठीक है या नहीं।

### निर्भरता

[यहां दिए गए चरणों](https://docs.python.org/3/tutorial/venv.html) का पालन करके एक python आभासी वातावरण बनाएं।

फिर निर्भरता स्थापित करें

```bash
pip install -r requirements.txt
```

### स्टेटिक सेटअप

[`main/.env`](main/.env) और [`main/.env.testing`](main/.env.testing) में `STATIC_ROOT` सेट करें (इसके लिए दोनों का मान समान होना चाहिए) एक खाली निर्देशिका का पथ (जैसे `/var/www/knotters/static/`) जहां आप सर्वर को `static` फ़ोल्डर से स्थिर फ़ाइलों को लोड करने की अनुमति दे सकते हैं।
सुनिश्चित करें कि आपने जो भी पथ निर्धारित किया है वह किसी भी निर्देशिका अनुमतियों द्वारा सर्वर के लिए प्रतिबंधित नहीं है।
यह भी सुनिश्चित करें कि आप इस प्रोजेक्ट की निर्देशिका में `./static` फ़ोल्डर के पथ के रूप में `STATIC_ROOT` को किसी भी तरह से सेट नहीं करते हैं।

फिर, स्थिर फ़ाइलों को लोड करने के लिए निम्न का उपयोग करें।

```bash
python3 genversion.py
python3 manage.py collectstatic
```

यह उन परीक्षणों को विफल होने से रोकेगा जो आपके `STATIC_ROOT` स्थान पर स्थिर फ़ाइलों की उपस्थिति पर निर्भर करते हैं।

आप अपने `STATIC_ROOT` पर एकत्रित स्थिर फ़ाइलों को संपीड़ित करने के लिए फॉलोविंग भी चला सकते हैं, हालांकि यह विकास/परीक्षण प्रक्रिया के लिए आवश्यक नहीं है।

```bash
python3 manage.py preparestatics /किसी भी/पथ/जहां/उत्पन्न/त्रुटियों/निर्देशिका/की जा सके/
```

### डेटाबेस सेटअप

```bash
python3 manage.py makemigrations
python3 manage.py migrate
```

ये आपके MongoDB सर्वर के डेटाबेस के रूप में .env में आपके `DB_NAME` नामित मान में संग्रह बनाएंगे।

यदि किसी प्रकार की डेटाबेस त्रुटि के कारण उपरोक्त आदेश आपके लिए विफल हो रहे हैं, तो आप समस्या को ठीक करने के लिए नीचे दिए गए चरणों का पालन कर सकते हैं।

- [`main/settings.py`](main/settings.py) में, निम्नलिखित कोड का पता लगाएं और उस पर टिप्पणी करें (अस्थायी रूप से)

```py
# इससे पहले
...
if not env.ISTESTING:
    INSTALLED_APPS.append("django_q")
...
```

```py
# बाद में
...
# if not env.ISTESTING:
#     INSTALLED_APPS.append("django_q")
...
```

- फिर उपरोक्त `makemigrations` और `migrate` कमांड को फिर से चलाएं।
- कमांड सफलतापूर्वक निष्पादित होने के बाद (आप अपने कंसोल पर `ओके` देख रहे हैं), फिर आप [`main/settings.py`](main/settings.py) में टिप्पणी किए गए हिस्से को अनकम्मेंट कर सकते हैं (या `git restore .`).

- फिर निम्नलिखित चलाएँ

```bash
python3 manage.py makemigrations
python3 manage.py migrate --fake
```

- यह आपके लिए समस्या को ठीक करना चाहिए।

### अधिसूचना सेटअप

स्रोत कोड से सूचना डेटा के साथ अपने डेटाबेस को सिंक्रनाइज़ करें

```bash
python3 manage.py syncnotifcations
```

### अकाउंट सेटअप

निम्न का उपयोग करके `.env` फ़ाइल में `BOTMAIL` मान के समान ईमेल पते का उपयोग करके एक सुपरयूज़र बनाएं:

```bash
python3 manage.py createsuperuser
```

नाम और पासवर्ड के लिए वैकल्पिक मान प्रदान करें (वेब ​​एप्लिकेशन के काम करने के लिए यह सुपरयूज़र खाता आवश्यक है) क्योंकि इस खाते का उपयोग बॉट के रूप में किया जाएगा।

फिर, उसी उपरोक्त आदेश का उपयोग करके, अपने लिए एक और सुपरयुसर खाता बनाएं। इस खाते का उपयोग `http://localhost:8000/<ADMINPATH>/` पर लॉगिन और प्रशासन दृश्य तक पहुंचने के लिए भी किया जा सकता है। यहां `<ADMINPATH>` आपके `.env` से एक पर्यावरण चर है।

## सर्वर

अपनी कार्यशील शाखा बदलें (हमेशा `शाखा: beta` से कोई भी नई शाखा बनाएं)

```bash
git pull
git checkout beta
git checkout -b your-branch-name
git status
```

फिर मुख्य सर्वर प्रक्रिया चलाएं (मान लें कि पोर्ट 8000 मुफ़्त है)

```bash
python3 manage.py runserver
```

अब आप [CONTRIBUTING.md](CONTRIBUTING.md) में कूदने के योग्य हैं, लेकिन पहले पूरा README.md पढ़ने के बाद ही इसकी अनुशंसा की जाती है।

यदि लोकलहोस्ट वेबसाइट में नेविगेट करते समय आपको `site matching query does not exist` जैसी त्रुटि मिल रही है, तो इसे हल करने के लिए निम्न कार्य करें

```bash
python3 manage.py shell
```

फिर पायथन के शैल में

```py
from django.contrib.sites.models import Site
Site.objects.create(id=1, name="Knotters", domain="example.com")
exit()
```

यह आपके लिए समस्या को ठीक करना चाहिए।

## परिक्षण

सुनिश्चित करें कि [`main/.env.testing`](main/.env.testing) उचित रूप से सेट है।

```bash
python3 manage.py test
```

```bash
python3 manage.py test <appname>
```

```bash
python3 manage.py test --tag=<tagname>
```

परीक्षणों की कवरेज रिपोर्ट के लिए

```bash
coverage run --source='.' manage.py test
coverage report
coverage html
```

## वैकल्पिक रूप से

सर्वर को चलाने के लिए निम्नलिखित सेटअप आवश्यक नहीं हैं, लेकिन किसी बिंदु पर इसकी आवश्यकता हो सकती है, इसलिए निम्नलिखित के माध्यम से भी जाने की अनुशंसा की जाती है।

### क्लस्टर सेटअप

एक `qcluster` को एक अलग शेल प्रक्रिया में शुरू किया जा सकता है, जो समय लेने वाले कार्यों को संभालने के लिए मुख्य सर्वर प्रक्रिया के समानांतर चलती है।

```bash
# .env फ़ाइल में रेडिस कॉन्फ़िगरेशन की आवश्यकता है
python3 manage.py qcluster
```

### क्लाइंट सेटअप

यदि आप क्लाइंट साइड सर्विस वर्कर अपडेट पर नियंत्रण रखना चाहते हैं, तो निम्न कमांड प्रत्येक निष्पादन पर [`main/__version__.py`](main/__version__.py) पर एक वर्जन टैग बनाए/अपडेट करेगा, जो सीधे इसके साथ जुड़ा हुआ है सेवा कार्यकर्ता, इसे वेब ब्राउज़र के माध्यम से एक अद्यतन उत्सर्जित करने के लिए मजबूर करता है।

```bash
python3 genversion.py
```

### स्टेटिक लाइब्रेरी अपडेट

इसका उपयोग केवल तभी किया जाना चाहिए जब स्थिर पुस्तकालयों को अद्यतन करने की आवश्यकता हो। यदि अपडेट किया गया है, तो फिर से जांचें कि क्या अपडेट की गई लाइब्रेरी से सब कुछ क्लाइंट साइड पर ठीक काम करता है।

```bash
python3 static.py
```

यह `static.json` में उल्लिखित पुस्तकालयों के स्रोत पथों को पढ़ेगा, और मौजूद पुस्तकालय फाइलों को अधिलेखित कर देगा। आपको इस फ़ाइल में आपके द्वारा उपयोग की जा सकने वाली किसी भी नई क्लाइंट साइड लाइब्रेरी के लिए अद्यतन स्रोत भी जोड़ना चाहिए।

### भाषा सेटअप

अपनी [`main/.env`](main/.env) फ़ाइल में स्थानीय गंतव्य पथ को `LOCALE_ABS_PATH` के रूप में सेट करें।

आप [github.com/Knotters/knottrans](https:/github.com/Knotters/knottrans) से मौजूदा Knotters अनुवाद संग्रह का क्लोन बना सकते हैं और `LOCALE_ABS_PATH` को `/<local-path-to-clone>/ के रूप में सेट कर सकते हैं। नॉटट्रांस/लोकेल/`, क्लोनिंग के बाद और उसमें `.po` फाइलों को जेनरेट/अपडेट करने से पहले उसमें एक नई शाखा बनाएं।

अनुवाद के लिए `.po` फ़ाइलें जेनरेट/अपडेट करने के लिए

```bash
python3 manage.py makemessages --extension=html,js
```

अपने `LOCALE_ABS_PATH` पर मौजूद `.po` फाइलों को `.mo` फाइलों में संकलित करने के लिए।

```bash
python3 manage.py compilemessages
```

यदि आप अनुवाद के लिए Knotters ट्रांसलेशन रिपोजिटरी का उपयोग कर रहे हैं, तो उस रिपॉजिटरी में भी अपनी खुद की शाखा बनाएं, और परिवर्तनों को भी प्रतिबद्ध करें और आगे बढ़ाएं।
अपने नए अनुवादों को वास्तव में परिनियोजित करने के लिए, इस रिपॉजिटरी में आपके संबंधित परिवर्तनों को सफलतापूर्वक `शाखा: main` पर लागू करने के बाद ही उस रिपॉजिटरी में एक पुल अनुरोध बनाएं।

**✨ यदि आपने Knotters प्लेटफॉर्म पर साइन अप किया है और उसी GitHub खाते का उपयोग कर रहे हैं जो इससे जुड़ा हुआ है और Knotters ट्रांसलेशन रिपोजिटरी में प्रतिबद्ध है, तो हमारे ट्रांसलेशन रिपॉजिटरी में योगदान करने से आपको Knotters प्लेटफॉर्म पर भी XP मिलते हैं, क्योंकि यह एक [सत्यापित प्रोजेक्ट](https://knotters.org/projects/@knottrans) का एक हिस्सा है [knotters.org](https://knotters.org) पर!**

## परिनियोजन

सभी कार्यप्रवाह `.github/workflows/` निर्देशिका में रखे जाते हैं।

विभिन्न ईवेंट ट्रिगर मामलों के लिए, रिपॉजिटरी में कुल 4 कार्यप्रवाह हैं।

- beta-server.yml: यह कार्यप्रवाह beta.knotters.org वातावरण में निर्माण और परिनियोजन के लिए `शाखा: beta` के लिए किसी भी कमिट पर ट्रिगर होता है

--

- main-pr.yml: यह कार्यप्रवाह परीक्षण वातावरण में परीक्षण के लिए `शाखा: main` के लिए किसी भी पुल अनुरोध पर ट्रिगर होता है।

--

- main-server.yml: यह कार्यप्रवाह किसी भी प्रतिबद्धता पर 'शाखा: main' के परीक्षण, निर्माण और परीक्षण, निर्माण और परिनियोजन के लिए, भंडार की स्थिर संपत्ति में परिवर्तन को छोड़कर, विशेष रूप से `static/` फ़ोल्डर के रूप में ट्रिगर किया जाता है स्थिर अद्यतनों को `main-client-static.yml` कार्यप्रवाह द्वारा नियंत्रित किया जाता है।
- main-client-static.yml: यह कार्यप्रवाह किसी भी प्रतिबद्धता पर 'शाखा: main' पर शुरू होता है, जो कि knotters.org वातावरण में परीक्षण, निर्माण और परिनियोजन के लिए होता है, लेकिन केवल तभी जब परिवर्तन भंडार की static संपत्ति तक सीमित हो, विशेष रूप से `static/` फ़ोल्डर, क्योंकि इस वर्कफ़्लो में नए क्लाइंट साइड संस्करण को रिलीज़ करने, नई static संपत्तियों को संपीड़ित और तैनात करने के लिए अतिरिक्त कार्य हैं। साथ ही, यह वर्कफ़्लो Knotters क्लस्टर को फिर से लोड नहीं करता है, यह मानते हुए कि क्लस्टर स्थिर संपत्ति परिवर्तनों पर निर्भर नहीं है। साथ ही, **कृपया सुनिश्चित करें कि `static/` निर्देशिका में सामग्री या कोड में कोई भी परिवर्तन एक ही बार में एक ही प्रतिबद्ध पर तैनात किया गया है, ताकि क्लाइंट साइड स्टैटिक अपडेट रिलीज़ के लिए अलग-अलग कमिट के कारण कई ट्रिगर से बचा जा सके।**

हमारे अपने सर्वर पर होस्ट किए गए रिपॉजिटरी में कुल 5 रनर हैं, क्योंकि उपरोक्त वर्कफ़्लो अपना काम करते हैं। निम्नलिखित सूची प्रत्येक धावक के काम की व्याख्या करती है।

- tester_knotters: सभी परीक्षण कार्य इस धावक पर चलते हैं। वर्तमान में परीक्षण केवल शाखा: मुख्य पर कमिट और पुल अनुरोधों तक सीमित है। beta.knotters.org पर परिनियोजन अभी के लिए परीक्षण का उपयोग नहीं करता है (बिना किसी विशेष कारण के)। परीक्षण वातावरण beta.knotters.org और समुद्री मील के वातावरण से अलग है। टैग: `self-hosted, testing`

--

- beta_builder: कोई भी कमिट जिसे `शाखा: beta` पर धकेला जाता है, `beta-server.yml` क्रिया को ट्रिगर करता है, जो इस रनर का उपयोग बीटा.knotters.org वातावरण के लिए निर्भरता और सेटअप को स्थापित/अपडेट करने के लिए करता है। टैग: `self-hosted, beta, building`
- beta_knotters: कोई भी प्रतिबद्धता जिसे `शाखा: beta` पर धकेला जाता है, `beta-server.yml` क्रिया को ट्रिगर करता है, जो इस धावक का उपयोग beta.knotters.org परिवेश पर नवीनतम परिवर्तनों को परिनियोजित करने के लिए करता है। परिनियोजन के लिए इस कार्य को चलाने के लिए सफल होने के लिए पिछले भवन कार्य की आवश्यकता है। टैग: `self-hosted, beta, deployment`

--

- builder_knotters: कोई भी कमिट जिसे `शाखा: main` पर धकेला जाता है, `main-server.yml`|`main-client.static.yml` क्रिया को ट्रिगर करता है, जो इस रनर का उपयोग knotters.org के लिए निर्भरता और सेटअप को स्थापित/अपडेट करने के लिए करता है। वातावरण। निर्माण के लिए इस कार्य को चलाने के लिए सफल होने के लिए परीक्षण कार्य की आवश्यकता है। टैग: `self-hosted, building, production`
- deploy_knotters: कोई भी कमिट जिसे `शाखा: main` पर धकेला जाता है, `main-server.yml`|`main-client.static.yml` क्रिया को ट्रिगर करता है, जो इस धावक का उपयोग knotters.org वातावरण पर नवीनतम परिवर्तनों को लागू करने के लिए करता है। परिनियोजन के लिए इस कार्य को चलाने के लिए सफल होने के लिए पिछले भवन कार्य की आवश्यकता है। टैग: `self-hosted, deployment, production`

## फुटनोट

- beta शाखा पर कोई भी कमिट इसे सीधे [beta.knotters.org](https://beta.knotters.org) पर तैनात कर देता है

- कोड प्रलेखन हर समारोह, वर्ग, आदि के लिए लगभग हर जगह मौजूद है।

- कुशल वर्कफ़्लो चलाने के लिए, अलग-अलग शाखाओं का उपयोग करके क्लाइंट साइड और सर्वर साइड कोड में बदलावों को अलग करने का प्रयास करें।

- बेहतर अपडेट डिलीवरी के लिए क्लाइंट साइड वाले से पहले सर्वर साइडेड बदलावों को प्रकाशित करने का प्रयास करें।

- तात्कालिक एकाधिक क्लाइंट साइड अपडेट से बचने के लिए एकल प्रतिबद्धता के अंतर्गत [`./static`](static) निर्देशिका में परिवर्तनों को समूहबद्ध करने का प्रयास करें।

- Wand (Python के लिए ImageMagick बंधन), जिसका उपयोग svg से png रूपांतरण के लिए किया जा रहा है, इसके लिए ImageMagick की स्थापना की आवश्यकता है। अपने सिस्टम पर ImageMagick की स्थापना करने के लिए [आधिकारिक Wand दस्तावेज़ीकरण](https://docs.wand-py.org/en/0.6.11/guide/install.html) का पालन करें।

विस्तृत योगदान मार्गदर्शिका के लिए अब [CONTRIBUTING.md](CONTRIBUTING.md) पर जाएं।
