# Knotters

Knotters प्लेटफॉर्म स्रोत कोड।

देखें [CONTRIBUTING.md](CONTRIBUTING.md) अगर आपने पूरा रीडमी.md पढ़ लिया है और इस फाइल में दिए निर्देश के अनुसार पहले ही रिपॉजिटरी सेटअप कर चुके हैं। यदि नहीं, तो पहले निम्न चरणों का पालन करें, फिर आगे के योगदान दिशानिर्देशों के लिए [CONTRIBUTING.md](CONTRIBUTING.md) पर जाएं।

## स्थापना

लिनक्स वातावरण को प्राथमिकता दी जाती है, इसलिए यदि आप अपने पीसी को लिनक्स के साथ बूट/डुअल बूट करने की योजना बना रहे थे, तो यह सही समय है।

विंडोज़ डेवलपर्स जो लिनक्स को बूट नहीं करना चाहते हैं, [सेटअप WSL](https://docs.microsoft.com/en-us/windows/wsl/install) पहले।

_सभी कमांड/बैश स्क्रिप्ट को प्रोजेक्ट डायरेक्टरी के मूल में निष्पादित माना जाना चाहिए, जब तक कि स्पष्ट रूप से निर्दिष्ट न हो।_

_`python3` (पायथन), `pip` (पायथन पैकेज मैनेजर) - ये cmdlets आपके सिस्टम प्लेटफॉर्म के आधार पर भिन्न हो सकते हैं, इसलिए, तदनुसार कार्य करें।_

### पूर्वापेक्षाएँ

- python 3.8.x या इसके बाद के संस्करण
- pip 20.x या ऊपर
- MongoDB (5.0.x) कनेक्शन स्ट्रिंग (mongodb://user:password@host:port/database)
- एक चलता redis (6.x या ऊपर) सर्वर

पहली बार स्थानीय रूप से mongodb स्थापित करने के लिए, [इन चरणों](https://www.digitalocean.com/community/tutorials/how-to-install-mongodb-on-ubuntu-18-04-source) को देखें

रेडिस को पहली बार स्थानीय रूप से स्थापित करने के लिए, [इन चरणों](https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-ubuntu-18-04) को देखें

WSL उपयोगकर्ताओं के लिए, `systemctl` जैसे कमांड मौजूद नहीं हो सकते हैं, इसलिए तदनुसार आगे बढ़ें। (उदाहरण के लिए `systemctl` के लिए `service` कमांड का उपयोग करें)

रेडिस सेट करने के बाद, अपनी रेडिस कॉन्फ़िगरेशन फ़ाइल (आमतौर पर /etc/redis/redis.conf पर) में acl अनुभाग में एक उपयोगकर्ता और पासवर्ड जोड़ी जोड़ें, जो सभी कुंजियों और सभी आदेशों तक पहुंच बनाएगी।
रेडिस में `requirepass` का अब उपयोग नहीं किया जा रहा है।

इसके कॉन्फ़िगरेशन में किसी भी बदलाव के बाद रेडिस को पुनरारंभ करें।

### पर्यावरण

```bash
python3 setup.py
```

[`main/.env`](main/.env) और [`main/.env.testing`](main/.env.testing) में मानों की मैन्युअल रूप से जाँच करें और साथ ही सब कुछ ठीक है या नहीं।

### निर्भरता

[यहां दिए गए चरणों](https://docs.python.org/3/tutorial/venv.html) का पालन करके एक python आभासी वातावरण बनाएं।

फिर निर्भरता स्थापित करें

```bash
pip install -r requirements.txt
```

### स्टेटिक सेटअप

[`main/.env`](main/.env) और [`main/.env.testing`](main/.env.testing) में `STATIC_ROOT` सेट करें (इसके लिए दोनों का मान समान होना चाहिए) एक खाली निर्देशिका का पथ (जैसे `/var/www/knotters/static/`) जहां आप सर्वर को `स्थैतिक` फ़ोल्डर से स्थिर फ़ाइलों को लोड करने की अनुमति दे सकते हैं।
सुनिश्चित करें कि आपने जो भी पथ निर्धारित किया है वह किसी भी निर्देशिका अनुमतियों द्वारा सर्वर के लिए प्रतिबंधित नहीं है।
यह भी सुनिश्चित करें कि आप इस प्रोजेक्ट की निर्देशिका में `./static` फ़ोल्डर के पथ के रूप में `STATIC_ROOT` को किसी भी तरह से सेट नहीं करते हैं।

फिर, स्थिर फ़ाइलों को लोड करने के लिए निम्न का उपयोग करें।

```bash
python3 genversion.py
python3 manage.py collectstatic
```

यह उन परीक्षणों को विफल होने से रोकेगा जो आपके `STATIC_ROOT` स्थान पर स्थिर फ़ाइलों की उपस्थिति पर निर्भर करते हैं।

आप अपने `STATIC_ROOT` पर एकत्रित स्थिर फ़ाइलों को संपीड़ित करने के लिए फॉलोविंग भी चला सकते हैं, हालांकि यह विकास/परीक्षण प्रक्रिया के लिए आवश्यक नहीं है।

```bash
python3 manage.py preparestatics /किसी भी/पथ/जहां/उत्पन्न/त्रुटियों/निर्देशिका/की जा सके/
```

### डेटाबेस सेटअप

```bash
python3 manage.py makemigrations
python3 manage.py migrate
```

ये आपके MongoDB सर्वर के डेटाबेस के रूप में .env में आपके `DB_NAME` नामित मान में संग्रह बनाएंगे।

यदि किसी प्रकार की डेटाबेस त्रुटि के कारण उपरोक्त आदेश आपके लिए विफल हो रहे हैं, तो आप समस्या को ठीक करने के लिए नीचे दिए गए चरणों का पालन कर सकते हैं।

- [`main/settings.py`](main/settings.py) में, निम्नलिखित कोड का पता लगाएं और उस पर टिप्पणी करें (अस्थायी रूप से)

```py
# इससे पहले
...
if not env.ISTESTING:
    INSTALLED_APPS.append("django_q")
...
```

```py
# बाद में
...
# if not env.ISTESTING:
#     INSTALLED_APPS.append("django_q")
...
```

- फिर उपरोक्त `makemigrations` और `migrate` कमांड को फिर से चलाएं।
- कमांड सफलतापूर्वक निष्पादित होने के बाद (आप अपने कंसोल पर `ओके` देख रहे हैं), फिर आप [`main/settings.py`](main/settings.py) में टिप्पणी किए गए हिस्से को अनकम्मेंट कर सकते हैं (या `git restore .`).

- फिर निम्नलिखित चलाएँ

```bash
python3 manage.py makemigrations
python3 manage.py migrate --fake
```

- यह आपके लिए समस्या को ठीक करना चाहिए।

### अधिसूचना सेटअप

स्रोत कोड से सूचना डेटा के साथ अपने डेटाबेस को सिंक्रनाइज़ करें

```bash
python3 manage.py syncnotifcations
```

### अकाउंट सेटअप

निम्न का उपयोग करके `.env` फ़ाइल में `BOTMAIL` मान के समान ईमेल पते का उपयोग करके एक सुपरयूज़र बनाएं:

```bash
python3 manage.py createsuperuser
```

नाम और पासवर्ड के लिए वैकल्पिक मान प्रदान करें (वेब ​​एप्लिकेशन के काम करने के लिए यह सुपरयूज़र खाता आवश्यक है) क्योंकि इस खाते का उपयोग बॉट के रूप में किया जाएगा।

फिर, उसी उपरोक्त आदेश का उपयोग करके, अपने लिए एक और सुपरयुसर खाता बनाएं। इस खाते का उपयोग `http://localhost:8000/<ADMINPATH>/` पर लॉगिन और प्रशासन दृश्य तक पहुंचने के लिए भी किया जा सकता है। यहां `<ADMINPATH>` आपके `.env` से एक पर्यावरण चर है।

## सर्वर

अपनी कार्यशील शाखा बदलें (हमेशा `शाखा: beta` से कोई भी नई शाखा बनाएं)

```bash
git pull
git checkout beta
git checkout -b your-branch-name
git status
```

फिर मुख्य सर्वर प्रक्रिया चलाएं (मान लें कि पोर्ट 8000 मुफ़्त है)

```bash
python3 manage.py runserver
```

अब आप [CONTRIBUTING.md](CONTRIBUTING.md) में कूदने के योग्य हैं, लेकिन पहले पूरा README.md पढ़ने के बाद ही इसकी अनुशंसा की जाती है।

यदि लोकलहोस्ट वेबसाइट में नेविगेट करते समय आपको `site matching query does not exist` जैसी त्रुटि मिल रही है, तो इसे हल करने के लिए निम्न कार्य करें

```bash
python3 manage.py shell
```

फिर पायथन के शैल में

```py
from django.contrib.sites.models import Site
Site.objects.create(id=1, name="Knotters", domain="example.com")
exit()
```

यह आपके लिए समस्या को ठीक करना चाहिए।

## परिक्षण

सुनिश्चित करें कि [`main/.env.testing`](main/.env.testing) उचित रूप से सेट है।

```bash
python3 manage.py test
```

```bash
python3 manage.py test <appname>
```

```bash
python3 manage.py test --tag=<tagname>
```

परीक्षणों की कवरेज रिपोर्ट के लिए

```bash
coverage run --source='.' manage.py test
coverage report
coverage html
```

## वैकल्पिक रूप से

सर्वर को चलाने के लिए निम्नलिखित सेटअप आवश्यक नहीं हैं, लेकिन किसी बिंदु पर इसकी आवश्यकता हो सकती है, इसलिए निम्नलिखित के माध्यम से भी जाने की अनुशंसा की जाती है।

### क्लस्टर सेटअप

एक `qcluster` को एक अलग शेल प्रक्रिया में शुरू किया जा सकता है, जो समय लेने वाले कार्यों को संभालने के लिए मुख्य सर्वर प्रक्रिया के समानांतर चलती है।

```bash
# .env फ़ाइल में रेडिस कॉन्फ़िगरेशन की आवश्यकता है
python3 manage.py qcluster
```

